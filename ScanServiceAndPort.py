import nmap
import socket

# Fonction pour scanner les ports d'une cible donnée


def scan_port_service(target):
    try:
        # Résolution du domaine en adresse IP
        ip_address = socket.gethostbyname(target)
    except socket.gaierror:
        print(f"Erreur : Impossible de résoudre le domaine {target}")
        return

    nm = nmap.PortScanner()

    try:
        # Scan des ports
        nm.scan(ip_address, arguments='-p 1-65535 -sV -Pn -T4')
    except nmap.PortScannerError as e:
        print(f"Erreur lors du scan : {e}")
        return

    # Récupération des résultats du scan
    for host in nm.all_hosts():
        print(f"Host : {host} ({nm[host].hostname()})")
        print(f"State : {nm[host].state()}")
        for proto in nm[host].all_protocols():
            print("----------")
            print(f"Protocol : {proto}")

            # Récupération des ports et services
            ports = nm[host][proto].keys()
            for port in ports:
                service = nm[host][proto][port]['name']
                product = nm[host][proto][port]['product']
                version = nm[host][proto][port]['version']
                print(f"Port : {port}\tService : {service}\tProduct : {product}\tVersion : {version}")


if __name__ == '__main__':
    # Remplacez par le domaine ou l'adresse IP de votre cible
    target_domain = '10.10.72.217'
    scan_port_service(target_domain)
